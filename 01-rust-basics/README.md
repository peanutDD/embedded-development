# Rust 基础语法教程

## 概述

本章节将全面介绍Rust编程语言的基础语法，为嵌入式开发打下坚实的基础。我们将从最基本的概念开始，逐步深入到高级特性。

## 学习目标

完成本章节后，你将掌握：
- Rust的基本语法和数据类型
- 所有权系统和借用检查
- 模式匹配和错误处理
- 泛型、特征和生命周期
- 并发编程基础
- 宏系统和元编程

## 章节内容

### 1.1 变量与数据类型
- **基础概念**: 变量声明、可变性、常量
- **数据类型**: 标量类型（整数、浮点、布尔、字符）
- **复合类型**: 元组、数组、切片
- **类型系统**: 类型推断、显式标注、类型别名
- **内存布局**: 栈vs堆、数据对齐、内存安全

### 1.2 所有权系统 ⭐
- **核心概念**: 所有权规则、RAII模式
- **移动语义**: 值的转移、Copy vs Move
- **借用机制**: 不可变借用、可变借用、借用检查器
- **生命周期**: 生命周期参数、省略规则、静态生命周期
- **智能指针**: Box、Rc、Arc、RefCell
- **实践示例**: [advanced_ownership.rs](examples/advanced_ownership.rs)

### 1.3 控制流
- **条件语句**: if/else、match表达式
- **循环结构**: loop、while、for、迭代器
- **模式匹配**: 解构、守卫、绑定模式
- **控制流工具**: break、continue、return

### 1.4 函数与闭包
- **函数系统**: 定义、参数、返回值、发散函数
- **高阶函数**: 函数作为参数、返回函数
- **闭包详解**: 语法、捕获模式、Fn特征族
- **函数指针**: fn类型、函数项类型

### 1.5 结构体与枚举
- **结构体**: 命名字段、元组结构体、单元结构体
- **方法系统**: impl块、self参数、关联函数
- **枚举类型**: 变体、数据承载、递归类型
- **标准枚举**: Option、Result、Ordering

### 1.6 集合类型
- **动态数组**: Vec、VecDeque、容量管理
- **哈希表**: HashMap、HashSet、自定义哈希
- **字符串**: String、&str、字符编码、格式化
- **其他集合**: BTreeMap、BTreeSet、LinkedList

### 1.7 错误处理 ⭐
- **Result系统**: Ok/Err、错误传播、?操作符
- **Option类型**: Some/None、空值处理
- **自定义错误**: Error特征、错误链、上下文
- **错误策略**: 恢复、重试、日志记录
- **实践示例**: [error_handling.rs](examples/error_handling.rs)

### 1.8 泛型与特征
- **泛型系统**: 函数泛型、结构体泛型、枚举泛型
- **特征定义**: 方法签名、默认实现、关联类型
- **特征实现**: 孤儿规则、条件实现、特征对象
- **标准特征**: Clone、Copy、Debug、Display、PartialEq

### 1.9 模块系统
- **模块组织**: mod关键字、文件模块、目录模块
- **可见性**: pub关键字、pub(crate)、pub(super)
- **导入系统**: use语句、重导出、glob导入
- **包结构**: lib.rs、main.rs、模块树

### 1.10 包管理
- **Cargo工具**: 项目创建、构建、测试、发布
- **依赖管理**: Cargo.toml、版本约束、特性标志
- **工作空间**: 多包项目、共享依赖
- **构建脚本**: build.rs、环境变量、条件编译

### 1.11 测试
- **单元测试**: #[test]、断言宏、测试组织
- **集成测试**: tests目录、测试二进制文件
- **文档测试**: 代码示例测试、隐藏代码
- **测试工具**: cargo test、测试过滤、并行测试

### 1.12 宏系统 ⭐
- **声明式宏**: macro_rules!、模式匹配、重复
- **过程宏**: 属性宏、派生宏、函数式宏
- **宏展开**: 编译时代码生成、AST操作
- **高级技巧**: 递归宏、TT muncher、DSL创建
- **实践示例**: [macro_system.rs](examples/macro_system.rs)

### 1.13 并发编程 ⭐
- **线程模型**: std::thread、线程生命周期、线程局部存储
- **消息传递**: mpsc通道、同步vs异步通道
- **共享状态**: Mutex、RwLock、Atomic类型
- **并发原语**: Barrier、Condvar、Once
- **实践示例**: [concurrency_demo.rs](examples/concurrency_demo.rs)

### 1.14 异步编程
- **异步模型**: async/await、Future特征、Pin
- **异步运行时**: tokio、async-std、执行器
- **异步I/O**: 非阻塞操作、事件循环
- **异步工具**: Stream、Sink、异步迭代器

### 1.15 Unsafe Rust
- **不安全操作**: 解引用裸指针、调用不安全函数
- **内存操作**: 手动内存管理、内存布局控制
- **FFI**: 外部函数接口、C互操作
- **安全抽象**: 在unsafe基础上构建安全接口

## 学习建议

### 学习顺序
建议按照章节顺序学习，每个章节都建立在前面章节的基础上：

1. **基础语法**（第1-3章）：掌握Rust的基本语法和控制流
2. **核心概念**（第4-6章）：理解函数、数据结构和集合
3. **高级特性**（第7-9章）：学习泛型、生命周期和错误处理
4. **系统编程**（第10-12章）：掌握模块系统、并发和内存管理
5. **高级主题**（第13-15章）：学习宏、异步编程和unsafe代码

### 实践建议
- 每学完一个章节，完成相应的练习题
- 尝试编写小项目来巩固所学知识
- 阅读Rust标准库源码，理解最佳实践
- 参与开源项目，提升实际编程能力

### 学习资源
- [Rust官方文档](https://doc.rust-lang.org/)
- [Rust程序设计语言](https://kaisery.github.io/trpl-zh-cn/)
- [Rust By Example](https://rustwiki.org/zh-CN/rust-by-example/)
- [Rustlings练习](https://github.com/rust-lang/rustlings)

## 总结

Rust是一门系统编程语言，具有以下特点：

### 核心优势
- **内存安全**：通过所有权系统防止内存泄漏和悬垂指针
- **并发安全**：编译时检查数据竞争，确保线程安全
- **零成本抽象**：高级特性不会带来运行时开销
- **跨平台**：支持多种操作系统和硬件架构

### 适用场景
- 系统编程和操作系统开发
- 嵌入式系统和物联网设备
- Web后端和网络服务
- 区块链和加密货币
- 游戏引擎和图形编程

### 学习成果
通过本章节的学习，你将：
- 掌握Rust的核心语法和概念
- 理解所有权系统和借用检查
- 能够编写安全、高效的Rust程序
- 为后续的嵌入式开发做好准备

继续学习下一章节：[嵌入式Rust开发环境](../02-embedded-setup/README.md)