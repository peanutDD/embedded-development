# PCF8574 I2C IO扩展器示例

本示例演示如何使用PCF8574 I2C IO扩展器来扩展微控制器的GPIO引脚数量。

## 功能特性

- **PCF8574驱动**: 完整的PCF8574 I2C IO扩展器驱动实现
- **GPIO扩展**: 通过I2C接口扩展8个GPIO引脚
- **输入输出控制**: 支持引脚的输入和输出模式
- **中断支持**: 支持输入变化中断检测
- **多设备支持**: 支持连接多个PCF8574设备
- **错误处理**: 完善的I2C通信错误处理机制

## 硬件连接

### PCF8574连接
```
PCF8574    STM32F4
VCC   -->  3.3V
GND   -->  GND
SDA   -->  PB7 (I2C1_SDA)
SCL   -->  PB6 (I2C1_SCL)
INT   -->  PA0 (可选，用于中断)
A0-A2 -->  GND/VCC (地址选择)
```

### LED连接 (连接到PCF8574的P0-P7)
```
PCF8574    LED
P0    -->  LED1 (通过限流电阻)
P1    -->  LED2 (通过限流电阻)
P2    -->  LED3 (通过限流电阻)
P3    -->  LED4 (通过限流电阻)
P4    -->  按键1 (上拉)
P5    -->  按键2 (上拉)
P6    -->  按键3 (上拉)
P7    -->  按键4 (上拉)
```

## 代码结构

- `main.rs`: 主程序，演示IO扩展器的基本使用
- `pcf8574.rs`: PCF8574驱动实现
- `lib.rs`: 库文件，导出公共接口

## 使用方法

1. 连接硬件
2. 编译并烧录程序：
   ```bash
   cargo run --bin main
   ```

## 示例功能

1. **基本IO操作**: 控制LED开关
2. **按键检测**: 读取按键状态
3. **中断处理**: 响应输入变化中断
4. **多设备管理**: 同时控制多个PCF8574
5. **错误恢复**: I2C通信错误的检测和恢复

## PCF8574特性

- **8位I/O端口**: 提供8个双向I/O引脚
- **I2C接口**: 标准I2C通信协议
- **地址选择**: 通过A0-A2引脚选择设备地址
- **中断输出**: 输入变化时产生中断信号
- **低功耗**: 静态电流小于2.5μA

## 注意事项

1. PCF8574的输出为开漏结构，需要外部上拉电阻
2. 输入模式时需要先写入高电平
3. 中断引脚为开漏输出，需要上拉电阻
4. I2C总线需要上拉电阻（通常4.7kΩ）